import{f as e,g as t,h as n,i as r,k as a,l as i,m as s,n as o,j as c,b as u,e as d,d as l,o as h,p as f,q as p,s as v,t as m,F as w}from"./index-fd32b983.js";import{$ as b,d as g}from"./dexie-react-hooks-84fc3a60.js";function x(){return(x=r(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=indexedDB.open(t);r.onsuccess=function(t){var n=t.target.result,r=n.version;n.close(),e(r)},r.onerror=function(e){n(e)}})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=new(function(r){e(c,b);var a=t(c);function c(){var e;return i(this,c),e=a.call(this,"dexie-database"),s(o(e),"friends",void 0),s(o(e),"t",void 0),e.version(5).stores({config:"&name,age"}),e}return n(c)}());function k(){g.useLiveQuery((function(){return y.friends.get("tables")}));var e=function(){var e=r(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=new FormData(t.currentTarget)).get("name"),n.get("fields");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t=function(){var e=r(a().mark((function e(t){var n,r,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new FormData(t.currentTarget),r=n.get("table"),i=n.get("value"),r&&i)try{i=JSON.parse(i),y[r].add(i)}catch(a){}case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return c(j,{children:[u("h4",{children:y.verno}),u("p",{children:"p"}),y.tables.map((function(e,t){return c("dl",{children:[u("dt",{children:e.name}),u("dd",{children:c("table",{children:[u("thead",{children:u("tr",{children:Object.keys(e.schema.indexes[0]).map((function(e){return u("th",{children:e},e)}))})}),u("tbody",{children:e.schema.indexes.map((function(e){return u("tr",{children:Object.entries(e).map((function(e){var t=d(e,2),n=t[0],r=t[1];return u("td",{children:"boolean"==typeof r?r?"o":"x":r},n)}))},e.name)}))})]})})]},e.name)})),c("dl",{children:[u("dt",{children:"add store"}),u("dd",{children:c("form",{method:"dialog",onSubmit:e,children:[u("input",{type:"text",name:"name",placeholder:"name"}),u("input",{type:"text",name:"fields",placeholder:"fields"}),u("input",{type:"submit",value:"add"})]})})]}),c("dl",{children:[u("dt",{children:"add row"}),u("dd",{children:c("form",{method:"dialog",onSubmit:t,children:[u("input",{type:"text",name:"table",placeholder:"table"}),u("textarea",{name:"value",placeholder:"value"}),u("input",{type:"submit",value:"add"})]})}),"s"]})]})}var j=l("div",{target:"e164evx40"})({name:"1h1rk8j",styles:"dd{white-space:pre-line;}table{border:1px solid #8888;padding:5px;border-radius:6px;td{background-color:#8882;text-align:center;vertical-align:middle;}}"});function B(){return u("div",{children:c("button",{onClick:function(){(function(e){return x.apply(this,arguments)})(y.name).then((function(e){})).catch(console.log)},children:["version up (cur: ",y.verno,")"]})})}var M=function(){function e(t,n){i(this,e),e.cache[t]=new Promise((function(e,r){var a=indexedDB.open(t,n);a.onsuccess=function(){e(a.result)},a.onerror=function(){r(a.error)}}))}var t;return n(e,[{key:"store",value:function(t){return new S(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"readwrite",e.cache[t])}}],[{key:"dbs",value:function(){var t=indexedDB.databases();return e.isDebug&&t.then(e.dbsLog),t}},{key:"dbsLog",value:function(e){}},{key:"info",value:(t=r(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.storage.estimate();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}();s(M,"isDebug",!1),s(M,"cache",{});var D,S=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"readwrite",r=arguments.length>2?arguments[2]:void 0;i(this,e),s(this,"db",void 0),s(this,"store",void 0),this.init(r,t,n)}var t,o;return n(e,[{key:"init",value:(o=r(a().mark((function e(t,n){var r,i=this,s=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=s.length>2&&void 0!==s[2]?s[2]:"readwrite",this.db=t,this.store=new Promise((function(e,t){i.db.then((function(t){var a=t.transaction(n,r);e(a.objectStore(n))}))}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"add",value:(t=r(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.store;case 2:e.sent.add(t,n);case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),P=new WeakMap,O=new WeakMap,W=new WeakMap,q=new WeakMap,F=new WeakSet,L=function(){function e(t,n){i(this,e),f(this,F),p(this,P,{writable:!0,value:void 0}),p(this,O,{writable:!0,value:void 0}),p(this,W,{writable:!0,value:!1}),p(this,q,{writable:!0,value:0}),v(this,F,N).call(this,t,n);var r={},a=new Promise((function(e,t){r.resolve=e,r.reject=t}));m(this,O,Object.assign(a,r))}var t,s,o;return n(e,[{key:"connected",get:function(){return h(this,W)}},{key:"version",get:function(){return h(this,q)}},{key:"versionchange",value:function(){}},{key:"store",value:(o=r(a().mark((function e(t,n){var i=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(){var e=r(a().mark((function e(s,o){var c,u,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(i,O);case 2:!1===(c=e.sent).objectStoreNames.contains(t)?(c.close(),v(i,F,N).call(i,c.name,c.version+1).onupgradeneeded=function(){var e=r(a().mark((function e(r){var i,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=r.target.result,o=i.createObjectStore(t,n),s(o);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()):(u=c.transaction(t,"readwrite"),d=u.objectStore(t),Array.from(d.indexNames),s(d));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})},{key:"tb",value:(s=r(a().mark((function e(t){var n,r,i=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"readwrite",e.next=3,h(this,O);case 3:return r=e.sent,e.abrupt("return",r.transaction(t,n).objectStore(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})}],[{key:"info",value:(t=r(a().mark((function e(){var t,n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.storage.estimate();case 2:return t=e.sent,n=t.quota,r=t.usage,e.abrupt("return",{quota:T(null!=n?n:0),usage:T(null!=r?r:0)});case 6:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}();function N(e,t){var n=this;return m(this,P,indexedDB.open(e,t)),h(this,P).onsuccess=function(){var e=h(n,P).result;h(n,O).resolve(e),m(n,W,!0),m(n,q,e.version)},h(this,P).onerror=function(){h(n,O).reject(h(n,P).error),m(n,W,!1)},h(this,P)}function T(e){if(0===e)return"0 Byte";var t=Math.floor(Math.log(e)/Math.log(1024));return"".concat(Math.round(e/Math.pow(1024,t))," ").concat(["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t])}function G(){return c(w,{children:[u(B,{}),u(k,{})]})}(D=r(a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new L("dbp"),e.next=4,t.store("test",{keyPath:"id",autoIncrement:!0});case 4:(n=e.sent).put({now:Date.now()}).onsuccess=function(e){},n.get(2).onsuccess=function(e){};case 8:case"end":return e.stop()}}),e)}))),function(){return D.apply(this,arguments)})();export{G as default};
