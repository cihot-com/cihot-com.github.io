import{b as e}from"./index-8f1f19a3.js";import{u as t,P as n,L as r}from"./motion-abf7f7de.js";import{c as s,u as o}from"./SVGVisualElement-210c37ed.js";import{u as i}from"./use-unmount-effect-e9aae080.js";function c(){const n=e.useRef(!1);return t((()=>(n.current=!0,()=>{n.current=!1})),[]),n}class PopChildMeasure extends e.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function u({children:t,isPresent:n}){const r=e.useId(),s=e.useRef(null),o=e.useRef({width:0,height:0,top:0,left:0});return e.useInsertionEffect((()=>{const{width:e,height:t,top:i,left:c}=o.current;if(n||!s.current||!e||!t)return;s.current.dataset.motionPopId=r;const u=document.createElement("style");return document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`\n          [data-motion-pop-id="${r}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${t}px !important;\n            top: ${i}px !important;\n            left: ${c}px !important;\n          }\n        `),()=>{document.head.removeChild(u)}}),[n]),e.createElement(PopChildMeasure,{isPresent:n,childRef:s,sizeRef:o},e.cloneElement(t,{ref:s}))}const a=({children:t,initial:r,isPresent:s,onExitComplete:i,custom:c,presenceAffectsLayout:a,mode:l})=>{const p=o(f),m=e.useId(),d=e.useMemo((()=>({id:m,initial:r,isPresent:s,custom:c,onExitComplete:e=>{p.set(e,!0);for(const t of p.values())if(!t)return;i&&i()},register:e=>(p.set(e,!1),()=>p.delete(e))})),a?void 0:[s]);return e.useMemo((()=>{p.forEach(((e,t)=>p.set(t,!1)))}),[s]),e.useEffect((()=>{!s&&!p.size&&i&&i()}),[s]),"popLayout"===l&&(t=e.createElement(u,{isPresent:s},t)),e.createElement(n.Provider,{value:d},t)};function f(){return new Map}const l=e=>e.key||"";const p=({children:n,custom:o,initial:u=!0,onExitComplete:f,exitBeforeEnter:p,presenceAffectsLayout:m=!0,mode:d="sync"})=>{const h=e.useContext(r).forceRender||function(){const t=c(),[n,r]=e.useState(0),o=e.useCallback((()=>{t.current&&r(n+1)}),[n]);return[e.useCallback((()=>s.postRender(o)),[o]),n]}()[0],E=c(),x=function(t){const n=[];return e.Children.forEach(t,(t=>{e.isValidElement(t)&&n.push(t)})),n}(n);let P=x;const y=e.useRef(new Map).current,R=e.useRef(P),C=e.useRef(new Map).current,g=e.useRef(!0);if(t((()=>{g.current=!1,function(e,t){e.forEach((e=>{const n=l(e);t.set(n,e)}))}(x,C),R.current=P})),i((()=>{g.current=!0,C.clear(),y.clear()})),g.current)return e.createElement(e.Fragment,null,P.map((t=>e.createElement(a,{key:l(t),isPresent:!0,initial:!!u&&void 0,presenceAffectsLayout:m,mode:d},t))));P=[...P];const k=R.current.map(l),w=x.map(l),L=k.length;for(let e=0;e<L;e++){const t=k[e];-1!==w.indexOf(t)||y.has(t)||y.set(t,void 0)}return"wait"===d&&y.size&&(P=[]),y.forEach(((t,n)=>{if(-1!==w.indexOf(n))return;const r=C.get(n);if(!r)return;const s=k.indexOf(n);let i=t;if(!i){const t=()=>{C.delete(n),y.delete(n);const e=R.current.findIndex((e=>e.key===n));if(R.current.splice(e,1),!y.size){if(R.current=x,!1===E.current)return;h(),f&&f()}};i=e.createElement(a,{key:l(r),isPresent:!1,onExitComplete:t,custom:o,presenceAffectsLayout:m,mode:d},r),y.set(n,i)}P.splice(s,0,i)})),P=P.map((t=>{const n=t.key;return y.has(n)?t:e.createElement(a,{key:l(t),isPresent:!0,presenceAffectsLayout:m,mode:d},t)})),e.createElement(e.Fragment,null,y.size?P:P.map((t=>e.cloneElement(t))))};export{p as A};
