import{r as e}from"./index-d2e29b82.js";import{A as t,t as n,u as r,P as s,L as o}from"./motion-f39b5207.js";function i(){const n=e.useRef(!1);return t((()=>(n.current=!0,()=>{n.current=!1})),[]),n}class PopChildMeasure extends e.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function c({children:t,isPresent:n}){const r=e.useId(),s=e.useRef(null),o=e.useRef({width:0,height:0,top:0,left:0});return e.useInsertionEffect((()=>{const{width:e,height:t,top:i,left:c}=o.current;if(n||!s.current||!e||!t)return;s.current.dataset.motionPopId=r;const u=document.createElement("style");return document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`\n          [data-motion-pop-id="${r}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${t}px !important;\n            top: ${i}px !important;\n            left: ${c}px !important;\n          }\n        `),()=>{document.head.removeChild(u)}}),[n]),e.createElement(PopChildMeasure,{isPresent:n,childRef:s,sizeRef:o},e.cloneElement(t,{ref:s}))}const u=({children:t,initial:n,isPresent:o,onExitComplete:i,custom:u,presenceAffectsLayout:f,mode:l})=>{const p=r(a),d=e.useId(),m=e.useMemo((()=>({id:d,initial:n,isPresent:o,custom:u,onExitComplete:e=>{p.set(e,!0);for(const t of p.values())if(!t)return;i&&i()},register:e=>(p.set(e,!1),()=>p.delete(e))})),f?void 0:[o]);return e.useMemo((()=>{p.forEach(((e,t)=>p.set(t,!1)))}),[o]),e.useEffect((()=>{!o&&!p.size&&i&&i()}),[o]),"popLayout"===l&&(t=e.createElement(c,{isPresent:o},t)),e.createElement(s.Provider,{value:m},t)};function a(){return new Map}const f=e=>e.key||"";const l=({children:r,custom:s,initial:c=!0,onExitComplete:a,exitBeforeEnter:l,presenceAffectsLayout:p=!0,mode:d="sync"})=>{let[m]=function(){const t=i(),[r,s]=e.useState(0),o=e.useCallback((()=>{t.current&&s(r+1)}),[r]);return[e.useCallback((()=>n.postRender(o)),[o]),r]}();const h=e.useContext(o).forceRender;h&&(m=h);const E=i(),x=function(t){const n=[];return e.Children.forEach(t,(t=>{e.isValidElement(t)&&n.push(t)})),n}(r);let P=x;const y=new Set,C=e.useRef(P),R=e.useRef(new Map).current,g=e.useRef(!0);var k;if(t((()=>{g.current=!1,function(e,t){e.forEach((e=>{const n=f(e);t.set(n,e)}))}(x,R),C.current=P})),k=()=>{g.current=!0,R.clear(),y.clear()},e.useEffect((()=>()=>k()),[]),g.current)return e.createElement(e.Fragment,null,P.map((t=>e.createElement(u,{key:f(t),isPresent:!0,initial:!!c&&void 0,presenceAffectsLayout:p,mode:d},t))));P=[...P];const w=C.current.map(f),L=x.map(f),v=w.length;for(let e=0;e<v;e++){const t=w[e];-1===L.indexOf(t)&&y.add(t)}return"wait"===d&&y.size&&(P=[]),y.forEach((t=>{if(-1!==L.indexOf(t))return;const n=R.get(t);if(!n)return;const r=w.indexOf(t);P.splice(r,0,e.createElement(u,{key:f(n),isPresent:!1,onExitComplete:()=>{R.delete(t),y.delete(t);const e=C.current.findIndex((e=>e.key===t));if(C.current.splice(e,1),!y.size){if(C.current=x,!1===E.current)return;m(),a&&a()}},custom:s,presenceAffectsLayout:p,mode:d},n))})),P=P.map((t=>{const n=t.key;return y.has(n)?t:e.createElement(u,{key:f(t),isPresent:!0,presenceAffectsLayout:p,mode:d},t)})),e.createElement(e.Fragment,null,y.size?P:P.map((t=>e.cloneElement(t))))};export{l as A};
