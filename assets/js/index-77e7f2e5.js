import{n as e,b as n,j as s}from"./index-890d70c3.js";const d=e.div`
  section {
    display: flex;
  }
`,t=()=>Math.random().toString(36).slice(2,10),o=(e,n="ddb-worker")=>{const s=new SharedWorker(e,{name:n});return s.port.start(),s};const r=()=>{const[e,r]=n.useState(1),{worker:c,reset:g}=((e,s="module")=>{const[d,o]=n.useState((()=>new Worker(e,{type:s,name:t()}))),r=n.useCallback((e=>{d.addEventListener("message",e)}),[d,o]),c=n.useCallback(((n=e)=>{d.terminate(),o(new Worker(n,{type:s,name:t()}))}),[e,s,d,o]),g=n.useCallback((e=>{d.postMessage(e)}),[d,o]);return n.useEffect((()=>{const e=e=>{const{data:n,source:s,origin:d}=e},n=e=>{};return d.addEventListener("message",e,!1),d.addEventListener("error",n,!1),d.addEventListener("messageerror",e,!1),()=>{d.removeEventListener("message",e,!1),d.removeEventListener("error",n,!1),d.removeEventListener("messageerror",e,!1),d.terminate()}}),[d]),n.useEffect((()=>{const e=e=>{};return addEventListener("rejectionhandled",e,!1),addEventListener("unhandledrejection",e,!1),()=>{removeEventListener("rejectionhandled",e,!1),removeEventListener("unhandledrejection",e,!1)}}),[]),{worker:d,on:r,reset:c,send:g}})("data:video/mp2t;base64,ZXhwb3J0IHt9OwoKY29uc29sZS5sb2coJ1t3b3JrZXIudHNdJywgbmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygpKTsKCmltcG9ydCB7IG51bWJlciB9IGZyb20gJ2VjaGFydHMnOwppbXBvcnQgeyBnZXRBcnJheUJ1ZmZlciB9IGZyb20gJy4vdXRpbCc7Cgpjb25zdCBwb29sOiBhbnlbXSA9IFtdOwoKLyogbWVzc2FnZSAqLwphZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgKGV2ZW50OiBNZXNzYWdlRXZlbnQpID0+IHsKICBjb25zdCB7IGRhdGEsIHNvdXJjZSwgb3JpZ2luIH0gPSBldmVudDsKICBjb25zb2xlLmxvZygnJWNbd29ya2VyLnRzXScsICdiYWNrZ3JvdW5kOiMwMGY4JywgZGF0YSwgc291cmNlLCBvcmlnaW4sIGV2ZW50KTsKCiAgaWYgKGRhdGEpIHsKICAgIHBvb2wucHVzaChkYXRhKTsKICB9IGVsc2UgewogICAgY29uc3QgdiA9IHBvb2wuc2hpZnQoKTsKICAgIGNvbnN0IGFiID0gZ2V0QXJyYXlCdWZmZXIodik7CgogICAgaWYgKGFiKSB7CiAgICAgIC8vIHBvc3RNZXNzYWdlKGFiLCAnKicsIFthYl0pOwogICAgICAvLyBAdHMtaWdub3JlCiAgICAgIHBvc3RNZXNzYWdlKGFiLCBbYWJdKTsKICAgIH0gZWxzZSB7CiAgICAgIHBvc3RNZXNzYWdlKHYpOwogICAgfQogIH0KCiAgcG9zdE1lc3NhZ2UoZGF0YSk7Cn0pOwoKLyogZXJyb3IgKi8KYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCAoZXZlbnQ6IEVycm9yRXZlbnQpID0+IHsKICBjb25zb2xlLndhcm4oJ1t3b3JrZXIudHMgLSBlcnJvcl0nLCBldmVudCk7Cn0pOwoKLyogbWVzc2FnZWVycm9yICovCmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2VlcnJvcicsIChldmVudDogTWVzc2FnZUV2ZW50KSA9PiB7CiAgY29uc29sZS53YXJuKCdbd29ya2VyLnRzIC0gbWVzc2FnZWVycm9yXScsIGV2ZW50KTsKfSk7CgovLyBwb3N0TWVzc2FnZSh7IHN0YXR1czogJ3JlYWR5JyB9KTsKLy8KLy8gbGV0IGNvdW50OiBudW1iZXIgPSAwOwovLyBzZXRJbnRlcnZhbCgoKSA9PiB7Ci8vICAgcG9zdE1lc3NhZ2UoKytjb3VudCk7Ci8vIH0sIDEwMDApOwo="),{sharedWorker:i,on:C}=function(e){const[s,d]=n.useState((()=>o(e)));return{sharedWorker:s,on:(e,n)=>{s.port.addEventListener(e,n)},reset:o,send:e=>{s.port.postMessage(e)}}}("data:video/mp2t;base64,bGV0IGNvdW50OiBudW1iZXIgPSAwOwpjb25zdCBzdGFydEF0ID0gRGF0ZS5ub3coKTsKCmFkZEV2ZW50TGlzdGVuZXIoJ2Nvbm5lY3QnLCAoZXZlbnQ6IGFueSkgPT4gewogIGNvbnN0IHsgcG9ydHMgfSA9IGV2ZW50OwogIGNvbnNvbGUubG9nKCdbc2hhcmVkV29ya2VyLnRzXScsIG5ldyBEYXRlKCkudG9Mb2NhbGVTdHJpbmcoKSwgcG9ydHMpOwoKICBBcnJheS5mcm9tKHBvcnRzKS5mb3JFYWNoKChwb3J0OiBhbnkpID0+IHsKICAgIHBvcnQuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIChldmVudDogTWVzc2FnZUV2ZW50KSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCdbc2hhcmVkV29ya2VyLnRzIC0gbWVzc2FnZV0nLCBldmVudCk7CgogICAgICBwb3J0LnBvc3RNZXNzYWdlKHsgZGF0YTogZXZlbnQuZGF0YSwgZnJvbTogJ3NoYXJlZFdvcmtlci50cycgfSk7CiAgICB9KTsKCiAgICBwb3J0LnN0YXJ0KCk7CgogICAgcG9ydC5wb3N0TWVzc2FnZSh7IGNvdW50OiArK2NvdW50LCBzdGFydEF0LCBwb3J0c0xlbmd0aDogcG9ydHMubGVuZ3RoIH0pOwogIH0pOwp9KTsKCi8vCi8vCi8vIGFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAoZXZlbnQ6IE1lc3NhZ2VFdmVudCkgPT4gewovLyAgIHBvc3RNZXNzYWdlKGV2ZW50LmRhdGEpOwovLyB9KTsKLy8KLy8gbGV0IGNvdW50OiBudW1iZXIgPSAwOwovLyBwb3N0TWVzc2FnZSh7IHN0YXR1czogKytjb3VudCB9KTsKLy8KLy8gc2V0SW50ZXJ2YWwoKCkgPT4gewovLyAgIHBvc3RNZXNzYWdlKHsgc3RhdHVzOiArK2NvdW50IH0pOwovLyB9LCAxMDAwKTsK");return n.useEffect((()=>{i.port.start(),i.port.addEventListener("message",(e=>{}))})),s.jsxs(d,{children:[s.jsxs("section",{children:[s.jsxs("button",{onClick:()=>r(e+1),children:["count: ",e]}),s.jsx("button",{onClick:()=>g(),children:"reset"}),s.jsx("button",{onClick:()=>c.postMessage("string"),children:"send string"}),s.jsx("button",{onClick:()=>c.postMessage({a:1}),children:"send object"}),s.jsx("button",{onClick:()=>c.postMessage([1,2,3]),children:"send array"}),s.jsx("button",{onClick:()=>c.postMessage(new ArrayBuffer(10)),children:"send arrayBuffer"}),s.jsx("button",{onClick:()=>{const e=new ArrayBuffer(10);c.postMessage(e,[e])},children:"send arrayBuffer and transfer"}),s.jsx("button",{onClick:()=>c.postMessage(new Int32Array([1,2,3])),children:"send typedArray"}),s.jsx("button",{onClick:()=>{const e=new Int32Array([1,2,3]);c.postMessage(e,[e.buffer])},children:"send typedArray and transfer"})]}),s.jsx("section",{children:s.jsx("button",{onClick:()=>i.port.postMessage("string"),children:"sw.send"})})]})};r.displayName="Worker";export{r as default};
